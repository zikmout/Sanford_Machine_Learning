define("bundles/course-references/actions/CourseReferencesActions",["require","exports","module","q","underscore","bundles/phoenix/lib/apiWrapper","jsuri","bundles/course-references/stores/CourseReferencesStore"],function(require,exports,module){"use strict";var e=require("q"),_=require("underscore"),r=require("bundles/phoenix/lib/apiWrapper"),n=require("jsuri"),s=require("bundles/course-references/stores/CourseReferencesStore"),t=r("/api/onDemandReferences.v1",{type:"rest"}),o=function hydrateResponse(e){return _(e.elements).each(function(r){var s=r.content["org.coursera.ondemand.reference.AssetReferenceContent"].assetId,n=_(e.linked["openCourseAssets.v1"]).where({id:s});n.length&&(r.content=n[0])})};exports.getReference=function(r,d){var a=d.referenceShortId,i=d.courseId,c=r.getStore(s).getCachedReference(a);if(!c){var f=(new n).addQueryParam("courseId",i).addQueryParam("q","shortId").addQueryParam("shortId",a).addQueryParam("fields","name,shortId,slug,content").addQueryParam("includes","assets"),u=e(t.get(f.toString())).then(function(e){var n=o(e);r.dispatch("LOAD_REFERENCE",n[0])});return u.done(),u}r.dispatch("LOAD_REFERENCE",c)}});